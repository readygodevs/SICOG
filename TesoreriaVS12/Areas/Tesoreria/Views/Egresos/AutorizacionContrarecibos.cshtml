@model IEnumerable<TesoreriaVS12.Areas.Tesoreria.Models.Ma_ContrarecibosModel>

@{
    ViewBag.Title = "AutorizacionContrarecibos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div id="_menu_lateral">
    @{ Html.RenderAction("Botonera", "Home", new { Area = "", ids = new List<object> { "bSalir" } }); }
</div>
<h2>Autorizacion de Gastos</h2>
<table class="table table-striped table-bordered" id="tablaContrarecibos">
    <thead>
        <tr>
            <th>Tipo</th>
            <th>Folio</th>
            <th>Fecha</th>
            <th>Descripción</th>
            <th>Importe</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @Html.DisplayFor(modelItem => item.Id_TipoCR)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Id_FolioCR)
                </td>
                <td>
                    @String.Format("{0:d}", item.FechaCR)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Descripcion)
                </td>
                <td>
                    @String.Format("{0:C}", item.Cargos.Value)
                </td>
                <td class="text-center acciones">
                    <a data-placement="top" data-toggle="tooltip" title="Mostrar Contrarecibo" data-id="@item.Id_TipoCR,@item.Id_FolioCR" class="fa fa-file-text-o js_mostrarContrarecibo"></a>
                    <a data-placement="top" data-toggle="tooltip" title="Partidas Sin Disponibilidad" data-id="@item.Id_TipoCR,@item.Id_FolioCR" class="fa fa-search js_verPartidas"></a>
                </td>
            </tr>
        }
    </tbody>
</table>

@section Scripts{
    <script src="~/Scripts/jquery.validate.min.js"></script>
    <script src="~/Scripts/jquery.validate.unobtrusive.min.js" class="jsValidate"></script>
    <script type="text/javascript">
        var tablaContrarecibos = "";
        var pos = "";
        $(document).on("ready", function () {
            $("[data-toggle='tooltip']").tooltip();
            tablaContrarecibos = ConstruirTabla("tablaContrarecibos");
            $("body").on("click", ".js_verPartidas", function () {
                pos = tablaContrarecibos.fnGetPosition($(this).closest('tr').get(0));
                var cadena = $(this).data("id").split(",");
                idTipo = cadena[0];
                idFolio = cadena[1];
                ajaxLoad("@Url.Action("GetPartidasSinDisponibilidadCR","Egresos")", { idTipoCR: idTipo, idFolioCR: idFolio }, "modal-body1", "POST", function () {
                    openModal({ Modal: "MyModal1", Size: "lg" });
                    ConstruirTabla("tabla_contrarecibos","No se encontraron registros",2);
                    $(".js_btnOk").remove();
                });
            });
            $(document).on("click", "#btnAutorizar", function () {
                ajaxJson("@Url.Action("AutorizarPartidasCR","Egresos")", { idTipoCR: idTipo, idFolioCR: idFolio }, "POST", true, function (datos) {
                    if (datos.Exito == true) {
                        closeModal();
                        tablaContrarecibos.fnDeleteRow(pos);
                        ExitoCustom("Las partidas se han autorizado con éxito");
                    }
                    else
                        ErrorCustom(datos.Mensaje);
                });
            });
            $("body").on("click", "#js_mSalir", function () {
                GoHome();
            });
        });
    </script>
}