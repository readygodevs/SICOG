@model TesoreriaVS12.Areas.Tesoreria.Models.CompromisosBusqueda

@{
    ViewBag.Title = "Análisis de Compromisos";
    Layout = "~/Views/Shared/_Layout.cshtml";
    String Ejercicio = ViewBag.Ejercicio;
}
<link href="~/Content/datepicker3.css" rel="stylesheet" />
<style>
    .custom-date {
    background-color: #ffffff !important;
    cursor:text !important;
}
    .row{
        margin-top:5px !important;
    }
</style>
<h2>Análisis de  Compromisos</h2>
<div id="_menu_lateral">
    @{ Html.RenderAction("Botonera", "Home", new { Area = "", ids = new List<object> { "bBuscar", "bLimpiar", "bSalir" } }); }
</div>
@using (Html.BeginForm("BuscarCompromisos", "Egresos", FormMethod.Post, new { id = "frmCompromisos" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)
    <br />
    <div class="container">
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-12">
                    <label>Tipo de Compromiso</label>
                </div>
            </div>
            <div class="col-xs-6">
                <div class="col-xs-12">
                    <label>Estatus</label>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-8">
                    @Html.DropDownListFor(model => model.Id_TipoCompromiso, Model.ListaId_TipoCompromiso, "--Seleccione una opción--", new { @class = "form-control" })
                </div>
            </div>
            <div class="col-xs-6">
                <div class="col-xs-8">
                    @Html.DropDownListFor(model => model.Estatus, Model.ListaEstatus, "--Seleccione una opción--", new { @class = "form-control" })
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-12">
                    <label>Beneficiario</label>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-11">
                <div class="col-xs-2">
                    <div class="input-group ">
                        @Html.TextBoxFor(model => model.Id_Beneficiario, new { @class = "form-control" })
                        <span class="input-group-addon js_Beneficiario">
                            <span class="fa fa-search"></span>
                        </span>
                    </div>
                </div>
                <div class="col-xs-9">
                    <input type="text" name="Desc_Beneficiario" id="Desc_Beneficiario" class="form-control" disabled="disabled" />
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-12">
                    <label>Especificar Rango de Importes</label>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-9">
                    <div class="col-xs-3">
                        <label>Desde</label>
                    </div>
                    <div class='col-xs-8'>
                        @Html.TextBoxFor(model => model.ImporteDesde, new { @class = "form-control", maxlength = 10 })
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-9">
                    <div class="col-xs-3">
                        <label>Hasta</label>
                    </div>
                    <div class='col-xs-8'>
                        @Html.TextBoxFor(model => model.ImporteHasta, new { @class = "form-control", maxlength = 10 })
                    </div>
                </div>
            </div>
        </div>
        <br />
        <div class="row">
            <div class="col-xs-6 js_divFechaOrden" style="margin-top: -17px">
                <div class="col-xs-12">
                    <label>Fecha de Compromiso</label>
                </div>
                <div class="col-xs-8">
                    <div class="col-xs-4">
                        <label>Desde</label>
                    </div>
                    <div class='col-xs-8 input-group '>
                        @Html.TextBoxFor(model => model.FechaDesdeOrden, new { @class = "form-control date", maxlength = 10 })
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 js_divFechaDevengado" style="margin-top: -17px">
                <div class="col-xs-12">
                    <label>Fecha de Devengado</label>
                </div>
                <div class="col-xs-8">
                    <div class="col-xs-4">
                        <label>Desde</label>
                    </div>
                    <div class='col-xs-8 input-group'>
                        @Html.TextBoxFor(model => model.FechaDesdeDevengado, new { @class = "form-control date", maxlength = 10 })
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6 js_divFechaDevengado">
                <div class="col-xs-8">
                    <div class="col-xs-4">
                        <label>Hasta</label>
                    </div>
                    <div class='col-xs-8 input-group'>
                        @Html.TextBoxFor(model => model.FechaHastaOrden, new { @class = "form-control date", maxlength = 10})
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
            <div class="col-xs-6 js_divFechaOrden">
                <div class="col-xs-8">
                    <div class="col-xs-4">
                        <label>Hasta</label>
                    </div>
                    <div class='col-xs-8 input-group'>
                        @Html.TextBoxFor(model => model.FechaHastaDevengado, new { @class = "form-control date", maxlength = 10 })
                        <span class="input-group-addon">
                            <span class="fa fa-calendar"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-1">
                    @Html.CheckBox("BusquedaAdquisiciones")
                </div>
                <div class="col-xs-11">
                    <label>Procedente de Adquisiciones</label>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-12">
                    <label>Establecer Orden del Reporte</label>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-6">
                <div class="col-xs-8">
                    <select name="Orden" id="Orden" class="form-control">
                        <option value="1">Tipo de Compromiso, Folio de Compromiso</option>
                        <option value="2">Proveedor, Folio de Compromiso</option>
                        <option value="3">Fecha de Compromiso</option>
                        <option value="4">Fecha de Devengado</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="row">
            <div id="div_resultados"></div>
        </div>
    </div>
}
@section Scripts {
    <script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js" class="jsValidate"></script>
    <script src="~/Scripts/bootstrap-datepicker.js"></script>
    <script src="~/Scripts/autoNumeric.js"></script>
    <script type="text/javascript">
        var buscarBeneficiario = function (modalSize) {
            $("body").on("click", ".js_Beneficiario", function () {
                if (!$(this).isSiblingDisabled())
                    customModal("@Url.Action("Buscar_Beneficiario","Busquedas")",
                            {},
                            "GET",
                            modalSize,
                            buscarBeneficiarioTbl,
                            "",
                            "Buscar",
                            "Cerrar",
                            "Buscar Beneficiario",
                            "MyModal1");
            });
        }

        var buscarBeneficiarioTbl = function () {
            $("#resultsBeneficiarios").ajaxLoad({ url: "@Url.Action("Tbl_Beneficiario","Busquedas")", method: "POST", data: { BDescripcionBeneficiario: $("#BDescripcionBeneficiario").val() } });
        }

        var seleccionarBeneficiario = function (modal) {
            $("body").on("click", "." + modal + " .js_SeleccionarBeneficiario", function () {
                var id = $(this).data("idbeneficiario");
                var desc = $(this).data("nombre");
                $("#Id_Beneficiario").val(id);
                $("#Desc_Beneficiario").val(desc);
                $("." + modal).modal("hide");
            });
        }
        var Anio = parseInt("@Ejercicio") - 1;
        Anio = '12/31/' + Anio;
        var Fecha = new Date(Anio);
        $(document).ready(function () {
            $("#ImporteDesde").autoNumeric();
            $("#ImporteHasta").autoNumeric();
            $("#Id_Beneficiario").on("input", function () {
                if ($(this).val().trim().length == 0)
                    $("#Desc_Beneficiario").val("");
            });
            $("#FechaDesdeOrden").val("");
            $("#FechaHastaOrden").val("");
            $("#FechaDesdeDevengado").val("");
            $("#FechaHastaDevengado").val("");
            $(".date").datepicker({
                format: 'dd/mm/yyyy',
                autoclose: true,
                startDate:Fecha,
                todayHighlight: true
            });
            $("#FechaDesdeOrden").on("change", function () {
                if ($(this).val().trim().length == 0) {
                    $("#FechaHastaOrden").val("");
                }
            });
            $("#FechaHastaOrden").on("change", function () {
                if ($(this).val().trim().length == 0)
                    $("#FechaDesdeOrden").val("");
            });
            $("#FechaDesdeDevengado").on("change", function () {
                if ($(this).val().trim().length == 0)
                    $("#FechaHastaDevengado").val("");
            });
            $("#FechaHastaDevengado").on("change", function () {
                if ($(this).val().trim().length == 0)
                    $("#FechaDesdeDevengado").val("");
            });
            $("#FechaDesdeOrden").datepicker().on("changeDate", function (e) {
                var fecha = new Date(e.date);
                $("#FechaHastaOrden").datepicker("update", new Date(fecha));
                $("#FechaHastaOrden").datepicker("setStartDate", new Date(fecha));
                $("#FechaHastaOrden").datepicker("setStartDate", Fecha);
                $("#FechaHastaOrden").attr("disabled", false);
            });
            $("#FechaDesdeDevengado").datepicker().on("changeDate", function (e) {
                var fecha = new Date(e.date);
                $("#FechaHastaDevengado").datepicker("update", new Date(fecha));
                $("#FechaHastaDevengado").datepicker("setStartDate", new Date(fecha));
                $("#FechaHastaDevengado").attr("disabled", false);
            });
            $("body").on("click", "#js_mBuscar", function () {
                $("#ImporteDesde").val($("#ImporteDesde").autoNumeric("get"));
                $("#ImporteHasta").val($("#ImporteHasta").autoNumeric("get"));
                $("#div_resultados").ajaxLoad({
                    url: $("#frmCompromisos").attr("action"),
                    data: $("#frmCompromisos").serialize(),
                    method: "POST",
                    callback: function () {
                        createBotonera(["bBuscar", "bLimpiar", "bImprimir", "bSalir"]);
                        ConstruirTabla("tblCompromisos");
                    }
                });
                $("#ImporteDesde").focus();
                $("#ImporteHasta").focus();
            });
            $("body").on("click", "#js_mLimpiar", function () {
                cleanInputs();
            });
            $("body").on("click", "#js_mImprimir", function () {
                window.open("@Url.Action("ReporteCompromisos","Egresos")"+"?" + $("#frmCompromisos").serialize(), "_blank");
            });
            $("body").on("click", "#js_mSalir", function () {
                GoHome();
            });

            $("#Id_Banco").on("change", function () {
                ajaxSelect("@Url.Action("List_CtaBancaria","Listas")", { Id_Banco: $("#Id_Banco").val() }, "POST", true, "Id_CtaBancaria", "", callBackLlenarSelect);
            });
            $("#Id_Beneficiario").on("focusout", function () {
                if ($(this).val().length > 0) {
                    $("#Id_Beneficiario").focusOut({
                        url: "@Url.Action("Beneficiario","FocusOut")",
                        data: { IdBeneficiario: $(this).val() },
                        campos: [{ Base: "NombreCompleto", Campo: "NombreBeneficiario" }]
                    });
                }
            });
            /**************Buscar beneficiario PROVEEDOR*****************/
            buscarBeneficiario("lg");

            seleccionarBeneficiario("MyModal1", "", "");
            /************************************************************/
            var cleanInputs = function () {
                $(".container input[type=text], textarea").val("");
                $(".container select").val("");
                $("#BusquedaAdquisiciones").prop("checked",false);
            }
        });
    </script>

}
