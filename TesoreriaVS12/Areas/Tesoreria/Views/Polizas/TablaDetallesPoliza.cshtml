@model IEnumerable<TesoreriaVS12.Areas.Tesoreria.Models.De_PolizasModel>

@{
    Layout = null;
}

<table id="tbldetalles" class="table table-responsive table-striped table-bordered">
    <thead>
        <tr>
            <th data-title="Id_ClavePresupuesto">
                @Html.DisplayNameFor(model => model.Id_ClavePresupuesto)
            </th>
            <th data-title="Id_Cuenta">
                @Html.DisplayNameFor(model => model.Id_Cuenta)
            </th>
            <th data-title="DescripcionMP">
                <label>Descripción</label>
            </th>
            <th data-title="Cargos" class="text-right">
                <label>Cargos</label>
            </th>
            <th data-title="Abonos" class="text-right">
                <label>Abonos</label>
            </th>
            <th data-title="Acciones">Acciones</th>
        </tr>
    </thead>
    <tbody>
        @{double cargo=0,abono=0;}
        @foreach (var item in Model)
        {
            <tr>
                <td>
                    @if (String.IsNullOrEmpty(item.Id_ClavePresupuesto))
                    {
                        @Html.Encode(item.Id_ClavePresupuestoIng);
                    }
                    else
                    {
                        @Html.Encode(item.Id_ClavePresupuesto);
                    }

                </td>

                <td>
                    @Html.DisplayFor(modelItem => item.Ca_Cuentas.Id_CuentaFormato)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Ca_Cuentas.Descripcion)
                </td>
                <td class="text-right">
                    @if (item.Id_Movimiento == 1)
                    { 
                         @Html.Encode(String.Format("{0:N}",item.Importe))
                        {cargo = cargo+Convert.ToDouble(item.Importe.Value);}
                    }
                    else
                    {
                        @Html.Encode("") 
                    }
                </td>
                <td class="text-right">
                    @if (item.Id_Movimiento == 2)
                    {
                        @Html.Encode(String.Format("{0:N}", item.Importe))
                        { abono = abono + Convert.ToDouble(item.Importe.Value); }
                    }
                    else
                    {
                        @Html.Encode("")
                    }
                </td>
                <td class="acciones">
                    <a class="fa fa-bars js_seleccionar cursorPointer" data-idFolio="@item.Id_FolioPoliza"  data-idTipo="@item.Id_TipoPoliza" data-idMes="@item.Id_MesPoliza" data-registro="@item.Id_Registro" title="Detalles" data-toggle="tooltip" data-placement="top"></a>
                    <a class="hide fa fa-trash-o js_Eliminar cursorPointer" data-idfolio="@item.Id_FolioPoliza" data-idtipo="@item.Id_TipoPoliza" data-idmes="@item.Id_MesPoliza" data-registro="@item.Id_Registro" title="Eliminar" data-toggle="tooltip" data-placement="top"></a>
                </td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <th colspan="3" class="text-right">Total:</th>
            <th class="js_totalfacturas text-right">
                
            </th>
            <th class="text-right">

            </th>
            <th>

            </th>
        </tr>
    </tfoot>
     @*<tfoot>
        <tr>
            <th colspan="3" style="text-align: right">Total:</th>
            <th><label>@String.Format("{0:C}", cargo)</label></th>
            <th><label>@String.Format("{0:C}", abono)</label></th>
            <th></th>
        </tr>
    </tfoot>*@
</table>
<script>
    var ConstruirTablaSaldos = function (div, mensaje) {
        if (mensaje == undefined || mensaje == "")
            mensaje = "No hay registros a mostrar";
        var tabla = $("#" + div).dataTable({
            "footerCallback": function (row, data, start, end, display) {
                var api = this.api(), data;
                // Remove the formatting to get integer data for summation
                var intVal = function (i) {
                    return typeof i === 'string' ?
                        i.replace(/[\$,]/g, '') * 1 :
                        typeof i === 'number' ?
                        i : 0;
                };
                // Total over all pages
                if ($("#" + div + " tbody tr").length > 0) {
                    if (!ultimo)
                    {
                        totalAbono = api
                    .column(4)
                    .data()
                    .reduce(function (a, b) {
                        return intVal(a) + intVal(b);
                    });
                        // Total over this page
                        // Update footer
                        $(api.column(4).footer()).html(
                            '<span class="js_currency">' + totalAbono + '</span>'
                        );
                        totalCargo = api
                            .column(3)
                            .data()
                            .reduce(function (a, b) {
                                return intVal(a) + intVal(b);
                            });
                        // Total over this page
                        // Update footer
                        $(api.column(3).footer()).html(
                            '<span class="js_currency">' + totalCargo + '</span>'
                        );
                        $(".js_currency").formatCurrency()
                    }
                    else
                    {
                        $(api.column(4).footer()).html('');
                        $(api.column(3).footer()).html('');
                        $(".js_currency").formatCurrency()
                    }
                }
                else {
                    $(api.column(4).footer()).html('');
                    $(api.column(3).footer()).html('');
                    $(".js_currency").formatCurrency()
                }
            },
            "sPaginationType": "full_numbers",
            "oLanguage": {
                "oPaginate": {
                    "sPrevious": "Anterior",
                    "sNext": "Siguiente",
                    "sLast": "Última",
                    "sFirst": "Primera"
                },
                "sLengthMenu": '<div id="combo_datatable">Mostrar <select>' +
                '<option value="5">5</option>' +
                '<option value="10">10</option>' +
                '<option value="20">20</option>' +
                '<option value="30">30</option>' +
                '<option value="40">40</option>' +
                '<option value="50">50</option>' +
                '<option value="-1">Todos</option>' +
                '</select> registros',
                "sInfo": "Mostrando del _START_ a _END_ (Total: _TOTAL_ resultados)",
                "sInfoFiltered": " - filtrados de _MAX_ registros",
                "sInfoEmpty": "No hay resultados de búsqueda",
                "sZeroRecords": mensaje,
                "sProcessing": "Espere, por favor...",
                "sSearch": "<div id='div_buscar'><i class='fa fa-search'></i>Buscar:</div>"
            }
        });
        return tabla;
    }
    $(function () {
        ConstruirTablaSaldos("tbldetalles", "No hay documentos...");
        $(".js_currency").formatCurrency();
    });

</script>
